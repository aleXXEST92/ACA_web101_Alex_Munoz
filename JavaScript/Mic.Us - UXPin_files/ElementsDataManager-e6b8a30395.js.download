function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}!function(e){"use strict";var t=new MooTools.Class({name:"ElementsDataManager",mElementsData:{},emitter:null,initialize:function(){this.mElementsData={categories:[],list:[]},this.emitter=new EventEmitter,this.appUrl=dpManager.STATIC_CONTENT_PREFIX_CACHED},emitElementsCategoriesChanged:function(){this.emit("elementsCategoriesChanged")},emitElementsListChanged:function(){this.emit("elementsListChanged")},fetchElementsFilesStructureOnlyOnce:_.once(function(){var e=this,t=this.appUrl+"/app/dmsDPElementsList/js/elements/filesStructure.json",n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){e.fetchElementsData(JSON.parse(n.response))},n.send()}),fetchElementsData:function(e){var t=this;_.forEach(e,function(e,n){if("account"===n)return void t.fetchAccountLibrary(e);("extended"!==n||uxpft.enabled(FEATURE_EXTENDEDLIBRARY))&&(t.fetchElementsCategories(e.categories),t.fetchElementsList(e.list))})},fetchElementsCategories:function(e){var t=this,n=new XMLHttpRequest;n.open("GET",this.appUrl+"/"+e,!0),n.onload=function(){t.mElementsData.categories=[].concat(_toConsumableArray(t.mElementsData.categories),_toConsumableArray(JSON.parse(n.response))),t.emitElementsCategoriesChanged()},n.send()},fetchElementsList:function(e){var t=this;_.forEach(e,function(e){var n=new XMLHttpRequest;n.open("GET",t.appUrl+"/"+e,!0),n.onload=function(){t.mElementsData.list=[].concat(_toConsumableArray(t.mElementsData.list),_toConsumableArray(JSON.parse(n.response))),t.emitElementsListChanged()},n.send()})},fetchAccountLibrary:function(e){var t=this,n=new XMLHttpRequest,s=e[dpManager.User.account_id];s&&(n.open("GET",this.appUrl+"/"+s,!0),n.onload=function(){var e=JSON.parse(n.response),s=e.categories,a=e.list;t.mElementsData.list=[].concat(_toConsumableArray(t.mElementsData.list),_toConsumableArray(a)),t.mElementsData.categories.splice(s.tree_order,0,s),t.emitElementsListChanged(),t.emitElementsCategoriesChanged()},n.send())},getCategoryIdByTitle:function(e){return _.find(this.mElementsData.categories,{title:e}).id_tree},getElementsInCategories:function(e){var t=this,n=[];return e.forEach(function(e){n.push(_.filter(t.mElementsData.list,{id_tree:e+=""}))}),_.flatten(n)},emit:function(e,t){this.emitter.emit(e,t)},addListener:function(e,t){this.emitter.on(e,t)},removeListener:function(e,t){this.emitter.off(e,t)}});e.ElementsDataManager=t}(window);
//# sourceMappingURL=maps/ElementsDataManager.js.map
